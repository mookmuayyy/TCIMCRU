<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCI Check-in</title>
</head>
<body>
    
</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCI Check-in - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(211, 47, 47, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(211, 47, 47, 0.3);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .qr-container {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-white text-red-600 rounded-full w-12 h-12 flex items-center justify-center font-bold text-xl">
                    TCI
                </div>
                <div>
                    <h1 class="text-xl font-bold">TCI Check-in</h1>
                    <p class="text-red-100 text-sm">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
                </div>
            </div>
            <div id="userInfo" class="hidden">
                <span id="userName" class="mr-4"></span>
                <button onclick="logout()" class="bg-red-800 hover:bg-red-900 px-4 py-2 rounded-lg transition-colors">
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Login Page -->
        <div id="loginPage" class="animate-fade-in">
            <div class="max-w-md mx-auto bg-white rounded-2xl card-shadow p-8">
                <div class="text-center mb-8">
                    <div class="bg-red-600 text-white rounded-full w-20 h-20 flex items-center justify-center font-bold text-3xl mx-auto mb-4">
                        TCI
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                    <p class="text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>

                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                        <input type="text" id="studentId" maxlength="9" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                               placeholder="xxxxxxxxx" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î)</label>
                        <input type="password" id="password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                               placeholder="07052005" required>
                    </div>
                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium">
                        üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button onclick="showRegister()" class="text-red-600 hover:text-red-800 font-medium">
                        üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="registerPage" class="hidden animate-fade-in">
            <div class="max-w-2xl mx-auto bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h2>
                
                <form id="registerForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                            <input type="text" id="regStudentId" maxlength="9" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                            <select id="prefix" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="firstName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="lastName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <input type="text" value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="phone" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="email" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î)</label>
                        <input type="password" id="regPassword" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                               placeholder="07052005" required>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium">
                            ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                        </button>
                        <button type="button" onclick="showLogin()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" class="hidden animate-fade-in">
            <div class="mb-8">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                    <h2 class="text-2xl font-bold text-blue-800 mb-1">üë©‚Äçüéì ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2>
                    <p class="text-blue-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <button onclick="showQRScanner()" class="bg-green-50 hover:bg-green-100 p-6 rounded-lg text-center transition-colors border-2 border-green-200">
                    <div class="text-4xl mb-3">üì±</div>
                    <h3 class="text-xl font-bold text-green-800 mb-2">‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
                    <p class="text-green-600 text-sm">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
                </button>
                <button onclick="showProfile()" class="bg-purple-50 hover:bg-purple-100 p-6 rounded-lg text-center transition-colors border-2 border-purple-200">
                    <div class="text-4xl mb-3">üë§</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                    <p class="text-purple-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</p>
                </button>
                <button onclick="showAllAttendanceHistory()" class="bg-blue-50 hover:bg-blue-100 p-6 rounded-lg text-center transition-colors border-2 border-blue-200">
                    <div class="text-4xl mb-3">üìä</div>
                    <h3 class="text-xl font-bold text-blue-800 mb-2">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <p class="text-blue-600 text-sm">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </button>
                <button onclick="showDetailedAnalytics()" class="bg-orange-50 hover:bg-orange-100 p-6 rounded-lg text-center transition-colors border-2 border-orange-200">
                    <div class="text-4xl mb-3">üìà</div>
                    <h3 class="text-xl font-bold text-orange-800 mb-2">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <p class="text-orange-600 text-sm">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</p>
                </button>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            </div>

            <div id="studentCourses" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Courses will be loaded here -->
            </div>

            <!-- Student Stats -->
            <div class="mt-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div id="studentStats" class="grid md:grid-cols-3 gap-6">
                    <!-- Stats will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div id="teacherDashboard" class="hidden animate-fade-in">
            <div class="mb-8">
                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
                    <h2 class="text-2xl font-bold text-red-800 mb-1">üë®‚Äçüè´ ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</h2>
                    <p class="text-red-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤, ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code, ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô, ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <p class="text-gray-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                <button onclick="showCreateCourse()" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                    + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div id="teacherCourses" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Courses will be loaded here -->
            </div>
        </div>

        <!-- Create Course Modal -->
        <div id="createCourseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                
                <form id="createCourseForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="courseCode" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</label>
                            <input type="number" id="credits" min="1" max="6" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <input type="text" id="courseName" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <select id="courseDay" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</option>
                                <option value="‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option>
                                <option value="‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option>
                                <option value="‡∏û‡∏∏‡∏ò">‡∏û‡∏∏‡∏ò</option>
                                <option value="‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option>
                                <option value="‡∏®‡∏∏‡∏Å‡∏£‡πå">‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                                <option value="‡πÄ‡∏™‡∏≤‡∏£‡πå">‡πÄ‡∏™‡∏≤‡∏£‡πå</option>
                                <option value="‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <input type="text" id="courseTime" placeholder="09:00-12:00" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input type="text" id="classroom" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium">
                            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
                        </button>
                        <button type="button" onclick="hideCreateCourse()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Check-in Modal -->
        <div id="checkinModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                
                <div id="checkinSteps" class="space-y-6">
                    <!-- Step 1: QR Code -->
                    <div id="step1" class="text-center">
                        <div class="bg-red-50 p-6 rounded-lg mb-4">
                            <div id="qrcode" class="qr-container flex justify-center mb-4"></div>
                            <p class="text-gray-600">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</p>
                            <p class="text-sm text-red-600 mt-2">QR Code ‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                        </div>
                        <button onclick="simulateQRScan()" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                            ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô QR
                        </button>
                    </div>

                    <!-- Step 2: GPS Check -->
                    <div id="step2" class="hidden text-center">
                        <div class="bg-blue-50 p-6 rounded-lg mb-4">
                            <div class="text-4xl mb-4">üìç</div>
                            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</p>
                            <div class="mt-4">
                                <div class="bg-blue-200 rounded-full h-2">
                                    <div id="gpsProgress" class="bg-blue-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Face Recognition -->
                    <div id="step3" class="hidden text-center">
                        <div class="bg-green-50 p-6 rounded-lg mb-4">
                            <div class="text-4xl mb-4">üì∏</div>
                            <p class="text-gray-600 mb-4">‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ã‡∏•‡∏ü‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</p>
                            <button onclick="simulateFaceRecognition()" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û
                            </button>
                        </div>
                    </div>

                    <!-- Success -->
                    <div id="stepSuccess" class="hidden text-center">
                        <div class="bg-green-50 p-6 rounded-lg mb-4">
                            <div class="text-6xl mb-4">‚úÖ</div>
                            <h4 class="text-xl font-bold text-green-600 mb-2">‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                            <p class="text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-sm text-gray-500 mt-2" id="checkinTime"></p>
                        </div>
                        <button onclick="closeCheckin()" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR Scanner Modal -->
        <div id="qrScannerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
                
                <div id="qrScannerContent">
                    <!-- Initial state -->
                    <div id="scannerInitial" class="bg-green-50 p-6 rounded-lg mb-6">
                        <div class="text-center mb-4">
                            <div class="text-6xl mb-4">üì±</div>
                            <div class="border-4 border-dashed border-green-300 rounded-lg p-8 mb-4">
                                <p class="text-green-600 font-medium">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR Code</p>
                                <p class="text-green-500 text-sm mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h4>
                            <ol class="text-green-700 text-sm space-y-1">
                                <li>1. ‡∏Ç‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</li>
                                <li>2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR Code"</li>
                                <li>3. ‡∏ß‡∏≤‡∏á QR Code ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</li>
                                <li>4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Camera view -->
                    <div id="cameraView" class="hidden">
                        <div class="bg-black rounded-lg overflow-hidden mb-4 relative">
                            <video id="qrVideo" class="w-full h-64 object-cover"></video>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="border-4 border-green-400 w-48 h-48 rounded-lg"></div>
                            </div>
                            <div class="absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-lg text-sm">
                                üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...
                            </div>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-600 text-sm mb-4">‡∏ß‡∏≤‡∏á QR Code ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°</p>
                            <button onclick="stopQRScanner()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô
                            </button>
                        </div>
                    </div>

                    <!-- Success state -->
                    <div id="scanSuccess" class="hidden text-center">
                        <div class="bg-green-50 p-6 rounded-lg mb-4">
                            <div class="text-6xl mb-4">‚úÖ</div>
                            <h4 class="text-xl font-bold text-green-600 mb-2">‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                            <p class="text-gray-600" id="scannedCourseInfo">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤...</p>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4" id="scannerButtons">
                    <button onclick="startQRScanner()" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium">
                        üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR Code
                    </button>
                    <button onclick="closeQRScanner()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                    <button onclick="closeProfile()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="text-center mb-8">
                    <div class="bg-purple-50 p-6 rounded-lg inline-block">
                        <div class="text-6xl mb-4">üë§</div>
                        <h4 class="text-xl font-bold text-purple-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h4>
                        <p class="text-purple-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    </div>
                </div>

                <div id="profileContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Course History Modal -->
        <div id="courseHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800" id="courseHistoryTitle">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <button onclick="closeCourseHistory()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div id="courseHistoryContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- All Attendance History Modal -->
        <div id="allAttendanceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <button onclick="closeAllAttendanceHistory()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div id="allAttendanceContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Detailed Analytics Modal -->
        <div id="detailedAnalyticsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <button onclick="closeDetailedAnalytics()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div id="detailedAnalyticsContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Course Registration QR Modal -->
        <div id="courseRegistrationQRModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">QR Code ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <button onclick="closeCourseRegistrationQR()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div id="registrationQRContent" class="text-center">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Course Management Modal -->
        <div id="courseManagementModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800" id="courseManagementTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <button onclick="closeCourseManagement()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <button onclick="showEditCourse()" class="bg-purple-50 hover:bg-purple-100 p-6 rounded-lg text-center transition-colors">
                        <div class="text-3xl mb-2">‚úèÔ∏è</div>
                        <h4 class="font-bold text-gray-800">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                        <p class="text-sm text-gray-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</p>
                    </button>
                    <button onclick="showQRCode()" class="bg-red-50 hover:bg-red-100 p-6 rounded-lg text-center transition-colors">
                        <div class="text-3xl mb-2">üì±</div>
                        <h4 class="font-bold text-gray-800">QR ‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h4>
                        <p class="text-sm text-gray-600">‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</p>
                    </button>
                    <button onclick="showAttendanceReport()" class="bg-blue-50 hover:bg-blue-100 p-6 rounded-lg text-center transition-colors">
                        <div class="text-3xl mb-2">üìä</div>
                        <h4 class="font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h4>
                        <p class="text-sm text-gray-600">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </button>
                    <button onclick="showStudentManagement()" class="bg-green-50 hover:bg-green-100 p-6 rounded-lg text-center transition-colors">
                        <div class="text-3xl mb-2">üë•</div>
                        <h4 class="font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h4>
                        <p class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                    </button>
                </div>

                <div id="courseManagementContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        let users = [
            {
                id: '664257001',
                password: '23082547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏Å‡∏£‡∏§‡∏ï',
                lastName: '‡∏•‡∏¥‡πâ‡∏°‡πÄ‡∏à‡∏£‡∏¥‡∏ç',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257002',
                password: '29112547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏Å‡∏§‡∏ï‡∏û‡∏£‡∏ï',
                lastName: '‡∏Ç‡∏à‡∏£‡∏Å‡∏µ‡∏£‡∏ï‡∏¥‡∏Å‡∏∏‡∏•',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257003',
                password: '02072547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏Å‡∏§‡∏ï‡∏¥‡∏ô',
                lastName: '‡∏Ç‡∏≥‡πÄ‡∏à‡∏£‡∏¥‡∏ç',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257004',
                password: '11022548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏Ñ‡∏ì‡∏¥‡∏ô',
                lastName: '‡∏á‡∏≤‡∏°‡πÄ‡∏õ‡∏≤‡∏∞',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257006',
                password: '25092547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡πÑ‡∏ä‡∏¢‡∏ß‡∏±‡∏í‡∏ô‡πå',
                lastName: '‡πÄ‡πÄ‡∏ï‡∏á‡∏ï‡∏∏‡πà‡∏ô',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257008',
                password: '20052548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏ô‡∏†‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå',
                lastName: '‡πÉ‡∏à‡∏†‡∏±‡∏Å‡∏î‡∏µ',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257009',
                password: '06012548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏ö‡∏π‡∏£‡∏û‡∏≤',
                lastName: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå‡∏Ñ‡∏∏‡πâ‡∏°',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257010',
                password: '16042546',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏õ‡∏≤‡∏£‡∏≤‡πÄ‡∏°‡∏®',
                lastName: '‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257012',
                password: '09052547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏°‡∏π‡∏Æ‡∏±‡∏°‡∏´‡∏°‡∏±‡∏î‡∏ü‡∏≤‡∏≠‡∏µ‡∏™',
                lastName: '‡πÄ‡∏ï‡πä‡∏∞',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257013',
                password: '15042548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏¢',
                firstName: '‡∏™‡∏∏‡∏†‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡πå',
                lastName: '‡∏†‡∏≤‡∏£‡∏∏‡∏ô‡∏±‡∏¢',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257014',
                password: '04102547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡∏Å‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì',
                lastName: '‡∏´‡∏≤‡∏ç‡∏°‡∏≤‡∏Å',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257018',
                password: '02072546',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡πÑ‡∏û‡∏•‡∏¥‡∏ô',
                lastName: '‡∏ô‡∏≤‡∏Ñ‡∏ß‡∏¥‡πÄ‡∏ä‡∏ï‡∏£‡πå',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257019',
                password: '10072548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡∏ß‡∏£‡∏∏‡∏ì‡∏£‡∏±‡∏ï‡∏ô‡πå',
                lastName: '‡∏ß‡∏á‡∏®‡πå‡∏ß‡∏ì‡∏¥‡∏ä‡∏û‡∏±‡∏ä‡∏£‡∏∞',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257020',
                password: '03032548',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡∏ß‡∏¥‡∏ì‡∏¥‡∏ä‡∏¢‡∏≤',
                lastName: '‡πÑ‡∏°‡πâ‡∏ï‡∏£‡∏≤',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257021',
                password: '09032547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡∏™‡∏¥‡∏î‡∏≤‡∏û‡∏£',
                lastName: '‡∏ä‡∏≤‡∏°‡πÇ‡∏™‡∏°',
                phone: '0812345678',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '664257022',
                password: '29072547',
                type: 'student',
                prefix: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                firstName: '‡∏™‡∏∏‡∏û‡∏¥‡∏ä‡∏ç‡∏≤',
                lastName: '‡∏Ñ‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠',
                phone: '0994860949',
                email: 'supichya@email.com',
                courses: ['TCI66617', 'TCI66618', 'TCI66716']
            },
            {
                id: '987654321',
                password: '11111111',
                type: 'teacher',
                prefix: '‡∏≠.‡∏î‡∏£.',
                firstName: '‡∏™‡∏ñ‡∏≤‡∏û‡∏£',
                lastName: '‡∏à‡∏∞‡∏ô‡∏∏',
                phone: '0898765432',
                email: 'sathaporn@email.com'
            }
        ];

        let courses = [
            {
                id: 'TCI66617',
                code: 'TCI66617',
                name: '‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                credits: 3,
                day: '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå',
                time: '08:30-12:30',
                classroom: '‡∏´‡πâ‡∏≠‡∏á SMC',
                teacher: '987654321',
                students: ['664257001','664257002','664257003','664257004','664257006','664257008','664257009','664257010','664257012','664257013','664257014','664257018','664257019','664257020','664257021','664257022',],
                attendance: []
            },
            {
                id: 'TCI66618',
                code: 'TCI66618',
                name: '‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                credits: 3,
                day: '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå',
                time: '13:30-17:30',
                classroom: '‡∏´‡πâ‡∏≠‡∏á MAC',
                teacher: '987654321',
                students: ['664257001','664257002','664257003','664257004','664257006','664257008','664257009','664257010','664257012','664257013','664257014','664257018','664257019','664257020','664257021','664257022',],
                attendance: []
            },
            {
                id: 'TCI66716',
                code: 'TCI66716',
                name: '‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Å‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                credits: 3,
                day: '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£',
                time: '13:30-17:30',
                classroom: '‡∏´‡πâ‡∏≠‡∏á MAC',
                teacher: '987654321',
                students: ['664257001','664257002','664257003','664257004','664257006','664257008','664257009','664257010','664257012','664257013','664257014','664257018','664257019','664257020','664257021','664257022',],
                attendance: []
            }
        ];

        let currentUser = null;
        let currentCourse = null;
        let qrUpdateInterval = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const studentId = document.getElementById('studentId').value;
            const password = document.getElementById('password').value;

            const user = users.find(u => u.id === studentId && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showDashboard();
            } else {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        });

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newUser = {
                id: document.getElementById('regStudentId').value,
                password: document.getElementById('regPassword').value,
                type: 'student',
                prefix: document.getElementById('prefix').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                courses: []
            };

            // Check if user already exists
            if (users.find(u => u.id === newUser.id)) {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            users.push(newUser);
            alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            showLogin();
        });

        // Create course functionality
        document.getElementById('createCourseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newCourse = {
                id: document.getElementById('courseCode').value,
                code: document.getElementById('courseCode').value,
                name: document.getElementById('courseName').value,
                credits: parseInt(document.getElementById('credits').value),
                day: document.getElementById('courseDay').value,
                time: document.getElementById('courseTime').value,
                classroom: document.getElementById('classroom').value,
                teacher: currentUser.id,
                students: [],
                attendance: []
            };

            courses.push(newCourse);
            
            // Generate sample QR code for the new course
            generateSampleQRCode(newCourse);
            
            alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            hideCreateCourse();
            loadTeacherCourses();
        });

        function showLogin() {
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
        }

        function showRegister() {
            hideAllPages();
            document.getElementById('registerPage').classList.remove('hidden');
        }

        function showDashboard() {
            hideAllPages();
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userName').textContent = `${currentUser.prefix}${currentUser.firstName} ${currentUser.lastName}`;

            if (currentUser.type === 'student') {
                document.getElementById('studentDashboard').classList.remove('hidden');
                loadStudentCourses();
                loadStudentStats();
            } else {
                document.getElementById('teacherDashboard').classList.remove('hidden');
                loadTeacherCourses();
            }
        }

        function hideAllPages() {
            const pages = ['loginPage', 'registerPage', 'studentDashboard', 'teacherDashboard'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        function loadStudentCourses() {
            const container = document.getElementById('studentCourses');
            const studentCourses = courses.filter(course => course.students.includes(currentUser.id));
            
            container.innerHTML = studentCourses.map(course => `
                <div class="bg-white rounded-2xl card-shadow p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${course.code}</h3>
                            <p class="text-gray-600">${course.name}</p>
                        </div>
                        <span class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-sm font-medium">
                            ${course.credits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï
                        </span>
                    </div>
                    <div class="space-y-2 mb-6">
                        <p class="text-sm text-gray-600">üìÖ ${course.day} ${course.time}</p>
                        <p class="text-sm text-gray-600">üè´ ${course.classroom}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="startCheckin('${course.id}')" 
                                class="btn-primary text-white py-3 rounded-lg font-medium text-sm">
                            ‚úÖ ‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠
                        </button>
                        <button onclick="showCourseHistory('${course.id}')" 
                                class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium text-sm transition-colors">
                            üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadTeacherCourses() {
            const container = document.getElementById('teacherCourses');
            const teacherCourses = courses.filter(course => course.teacher === currentUser.id);
            
            container.innerHTML = teacherCourses.map(course => `
                <div class="bg-white rounded-2xl card-shadow p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${course.code}</h3>
                            <p class="text-gray-600">${course.name}</p>
                        </div>
                        <span class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-sm font-medium">
                            ${course.credits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï
                        </span>
                    </div>
                    <div class="space-y-2 mb-6">
                        <p class="text-sm text-gray-600">üìÖ ${course.day} ${course.time}</p>
                        <p class="text-sm text-gray-600">üè´ ${course.classroom}</p>
                        <p class="text-sm text-gray-600">üë• ${course.students.length} ‡∏Ñ‡∏ô</p>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="manageCourse('${course.id}')" 
                                class="btn-primary text-white py-3 rounded-lg font-medium text-xs">
                            üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                        </button>
                        <button onclick="showCourseRegistrationQR('${course.id}')" 
                                class="bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium text-xs transition-colors">
                            üì± QR ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                        </button>
                        <button onclick="deleteCourseFromList('${course.id}')" 
                                class="bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium text-xs transition-colors">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadStudentStats() {
            const container = document.getElementById('studentStats');
            const studentCourses = courses.filter(course => course.students.includes(currentUser.id));
            
            container.innerHTML = studentCourses.map(course => {
                const totalClasses = 16; // Assume 16 weeks per semester
                const attendedClasses = course.attendance.filter(a => a.studentId === currentUser.id).length;
                const percentage = Math.round((attendedClasses / totalClasses) * 100);
                
                return `
                    <div class="bg-white rounded-2xl card-shadow p-6">
                        <h4 class="text-lg font-bold text-gray-800 mb-2">${course.code}</h4>
                        <div class="text-3xl font-bold ${percentage >= 80 ? 'text-green-600' : 'text-red-600'} mb-2">
                            ${percentage}%
                        </div>
                        <p class="text-sm text-gray-600">${attendedClasses}/${totalClasses} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                        ${percentage < 80 ? '<p class="text-xs text-red-600 mt-2">‚ö†Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 80%</p>' : ''}
                    </div>
                `;
            }).join('');
        }

        function startCheckin(courseId) {
            currentCourse = courses.find(c => c.id === courseId);
            document.getElementById('checkinModal').classList.remove('hidden');
            
            // Reset steps
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('stepSuccess').classList.add('hidden');
            
            generateQRCode();
        }

        function generateQRCode() {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const qrData = `TCI-CHECKIN:${currentCourse.id}:${Date.now()}:${currentUser.id}`;
            
            QRCode.toCanvas(qrData, { width: 200, height: 200 }, function (error, canvas) {
                if (error) console.error(error);
                qrContainer.appendChild(canvas);
            });

            // Update QR code every 30 seconds
            if (qrUpdateInterval) clearInterval(qrUpdateInterval);
            qrUpdateInterval = setInterval(generateQRCode, 30000);
        }

        function simulateQRScan() {
            if (qrUpdateInterval) clearInterval(qrUpdateInterval);
            
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            
            // Simulate GPS check
            let progress = 0;
            const gpsInterval = setInterval(() => {
                progress += 20;
                document.getElementById('gpsProgress').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(gpsInterval);
                    setTimeout(() => {
                        document.getElementById('step2').classList.add('hidden');
                        document.getElementById('step3').classList.remove('hidden');
                    }, 500);
                }
            }, 200);
        }

        function simulateFaceRecognition() {
            document.getElementById('step3').classList.add('hidden');
            
            // Simulate face recognition processing
            setTimeout(() => {
                // Record attendance
                const attendance = {
                    studentId: currentUser.id,
                    courseId: currentCourse.id,
                    timestamp: new Date(),
                    status: 'present'
                };
                
                currentCourse.attendance.push(attendance);
                
                document.getElementById('checkinTime').textContent = 
                    `‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}`;
                document.getElementById('stepSuccess').classList.remove('hidden');
                
                // Update student stats
                loadStudentStats();
            }, 2000);
        }

        function closeCheckin() {
            document.getElementById('checkinModal').classList.add('hidden');
            if (qrUpdateInterval) clearInterval(qrUpdateInterval);
        }

        function manageCourse(courseId) {
            currentCourse = courses.find(c => c.id === courseId);
            document.getElementById('courseManagementModal').classList.remove('hidden');
            document.getElementById('courseManagementTitle').textContent = 
                `‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${currentCourse.code}`;
            showQRCode();
        }

        function closeCourseManagement() {
            document.getElementById('courseManagementModal').classList.add('hidden');
            if (qrUpdateInterval) clearInterval(qrUpdateInterval);
        }

        function showQRCode() {
            const content = document.getElementById('courseManagementContent');
            content.innerHTML = `
                <div class="text-center">
                    <h4 class="text-xl font-bold text-gray-800 mb-6">QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h4>
                    <div class="bg-gray-50 p-8 rounded-lg inline-block">
                        <div id="teacherQRCode" class="qr-container"></div>
                        <p class="text-sm text-gray-600 mt-4">QR Code ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                    </div>
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                        <p class="text-blue-800 font-medium">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</p>
                        <p class="text-blue-600 text-sm mt-2">1. ‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏ô‡∏µ‡πâ‡∏ö‡∏ô‡∏à‡∏≠</p>
                        <p class="text-blue-600 text-sm">2. ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ</p>
                        <p class="text-blue-600 text-sm">3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                    </div>
                </div>
            `;
            
            generateTeacherQRCode();
        }

        function generateTeacherQRCode() {
            const qrContainer = document.getElementById('teacherQRCode');
            if (!qrContainer) return;
            
            qrContainer.innerHTML = '';
            
            const qrData = `TCI-CHECKIN:${currentCourse.id}:${Date.now()}:TEACHER`;
            
            QRCode.toCanvas(qrData, { width: 300, height: 300 }, function (error, canvas) {
                if (error) console.error(error);
                qrContainer.appendChild(canvas);
            });

            // Update QR code every 30 seconds
            if (qrUpdateInterval) clearInterval(qrUpdateInterval);
            qrUpdateInterval = setInterval(generateTeacherQRCode, 30000);
        }

        function showAttendanceReport() {
            const content = document.getElementById('courseManagementContent');
            const students = users.filter(u => currentCourse.students.includes(u.id));
            
            content.innerHTML = `
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-6">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg overflow-hidden">
                            <thead class="bg-red-600 text-white">
                                <tr>
                                    <th class="px-4 py-3 text-left">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th class="px-4 py-3 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-3 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th class="px-4 py-3 text-center">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th>
                                    <th class="px-4 py-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.map(student => {
                                    const totalClasses = 16;
                                    const attendedClasses = currentCourse.attendance.filter(a => a.studentId === student.id).length;
                                    const percentage = Math.round((attendedClasses / totalClasses) * 100);
                                    
                                    return `
                                        <tr class="border-b border-gray-200">
                                            <td class="px-4 py-3">${student.id}</td>
                                            <td class="px-4 py-3">${student.prefix}${student.firstName} ${student.lastName}</td>
                                            <td class="px-4 py-3 text-center">${attendedClasses}/${totalClasses}</td>
                                            <td class="px-4 py-3 text-center">
                                                <span class="px-2 py-1 rounded-full text-sm ${percentage >= 80 ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                                    ${percentage}%
                                                </span>
                                            </td>
                                            <td class="px-4 py-3 text-center">
                                                ${percentage >= 80 ? '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô' : '‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-6 flex space-x-4">
                        <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                        </button>
                        <button onclick="exportToPDF()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF
                        </button>
                    </div>
                </div>
            `;
        }

        function showEditCourse() {
            const content = document.getElementById('courseManagementContent');
            content.innerHTML = `
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h4>
                    <form id="editCourseForm" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                                <input type="text" id="editCourseCode" value="${currentCourse.code}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</label>
                                <input type="number" id="editCredits" value="${currentCourse.credits}" min="1" max="6" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="editCourseName" value="${currentCourse.name}" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <select id="editCourseDay" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                                    <option value="‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå" ${currentCourse.day === '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå' ? 'selected' : ''}>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option>
                                    <option value="‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£" ${currentCourse.day === '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£' ? 'selected' : ''}>‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option>
                                    <option value="‡∏û‡∏∏‡∏ò" ${currentCourse.day === '‡∏û‡∏∏‡∏ò' ? 'selected' : ''}>‡∏û‡∏∏‡∏ò</option>
                                    <option value="‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ" ${currentCourse.day === '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ' ? 'selected' : ''}>‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option>
                                    <option value="‡∏®‡∏∏‡∏Å‡∏£‡πå" ${currentCourse.day === '‡∏®‡∏∏‡∏Å‡∏£‡πå' ? 'selected' : ''}>‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                                    <option value="‡πÄ‡∏™‡∏≤‡∏£‡πå" ${currentCourse.day === '‡πÄ‡∏™‡∏≤‡∏£‡πå' ? 'selected' : ''}>‡πÄ‡∏™‡∏≤‡∏£‡πå</option>
                                    <option value="‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå" ${currentCourse.day === '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå' ? 'selected' : ''}>‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <input type="text" id="editCourseTime" value="${currentCourse.time}" placeholder="09:00-12:00" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <input type="text" id="editClassroom" value="${currentCourse.classroom}" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                            </button>
                            <button type="button" onclick="deleteCourse()" 
                                    class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
                            </button>
                        </div>
                    </form>
                </div>
            `;

            document.getElementById('editCourseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Update course data
                currentCourse.code = document.getElementById('editCourseCode').value;
                currentCourse.name = document.getElementById('editCourseName').value;
                currentCourse.credits = parseInt(document.getElementById('editCredits').value);
                currentCourse.day = document.getElementById('editCourseDay').value;
                currentCourse.time = document.getElementById('editCourseTime').value;
                currentCourse.classroom = document.getElementById('editClassroom').value;
                
                // Update in courses array
                const courseIndex = courses.findIndex(c => c.id === currentCourse.id);
                if (courseIndex !== -1) {
                    courses[courseIndex] = currentCourse;
                }
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                loadTeacherCourses();
                
                // Update modal title
                document.getElementById('courseManagementTitle').textContent = 
                    `‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${currentCourse.code}`;
            });
        }

        function deleteCourse() {
            // Check if current user is the teacher of this course
            if (currentCourse.teacher !== currentUser.id) {
                alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ');
                return;
            }
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${currentCourse.code} - ${currentCourse.name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:\n‚Ä¢ ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (${currentCourse.students.length} ‡∏Ñ‡∏ô)\n‚Ä¢ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${currentCourse.attendance.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`)) {
                // Store course info for confirmation message
                const courseInfo = {
                    code: currentCourse.code,
                    name: currentCourse.name,
                    studentsCount: currentCourse.students.length,
                    attendanceCount: currentCourse.attendance.length
                };
                
                // Remove course from courses array
                const courseIndex = courses.findIndex(c => c.id === currentCourse.id);
                if (courseIndex !== -1) {
                    courses.splice(courseIndex, 1);
                }
                
                // Remove course from all students
                users.forEach(user => {
                    if (user.courses && user.courses.includes(currentCourse.id)) {
                        user.courses = user.courses.filter(courseId => courseId !== currentCourse.id);
                    }
                });
                
                // Update current user if they were enrolled
                if (currentUser && currentUser.courses && currentUser.courses.includes(currentCourse.id)) {
                    currentUser.courses = currentUser.courses.filter(courseId => courseId !== currentCourse.id);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                alert(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${courseInfo.code} - ${courseInfo.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n\n‚Ä¢ ‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${courseInfo.studentsCount} ‡∏Ñ‡∏ô\n‚Ä¢ ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${courseInfo.attendanceCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                closeCourseManagement();
                loadTeacherCourses();
                
                // Refresh student dashboard if current user is a student
                if (currentUser && currentUser.type === 'student') {
                    loadStudentCourses();
                    loadStudentStats();
                }
            }
        }

        function deleteCourseFromList(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (!course) return;
            
            // Check if current user is the teacher of this course
            if (course.teacher !== currentUser.id) {
                alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ');
                return;
            }
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${course.code} - ${course.name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:\n‚Ä¢ ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (${course.students.length} ‡∏Ñ‡∏ô)\n‚Ä¢ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${course.attendance.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`)) {
                // Remove course from courses array
                const courseIndex = courses.findIndex(c => c.id === courseId);
                if (courseIndex !== -1) {
                    courses.splice(courseIndex, 1);
                }
                
                // Remove course from all students
                users.forEach(user => {
                    if (user.courses && user.courses.includes(courseId)) {
                        user.courses = user.courses.filter(id => id !== courseId);
                    }
                });
                
                // Update current user if they were enrolled
                if (currentUser && currentUser.courses && currentUser.courses.includes(courseId)) {
                    currentUser.courses = currentUser.courses.filter(id => id !== courseId);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                alert(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${course.code} - ${course.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n\n‚Ä¢ ‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${course.students.length} ‡∏Ñ‡∏ô\n‚Ä¢ ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${course.attendance.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                loadTeacherCourses();
                
                // Refresh student dashboard if current user is a student
                if (currentUser && currentUser.type === 'student') {
                    loadStudentCourses();
                    loadStudentStats();
                }
            }
        }

        function showStudentManagement() {
            const content = document.getElementById('courseManagementContent');
            const enrolledStudents = users.filter(u => currentCourse.students.includes(u.id));
            const availableStudents = users.filter(u => u.type === 'student' && !currentCourse.students.includes(u.id));
            
            content.innerHTML = `
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h4>
                    
                    <!-- Add Student Section -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                        <h5 class="text-lg font-bold text-green-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h5>
                        <div class="flex space-x-4">
                            <input type="text" id="addStudentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (9 ‡∏´‡∏•‡∏±‡∏Å)" maxlength="9"
                                   class="flex-1 px-4 py-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <button onclick="addStudentToCourse()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°
                            </button>
                        </div>
                        <p class="text-green-600 text-sm mt-2">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </div>

                    <!-- Enrolled Students -->
                    <div class="bg-white rounded-lg border border-gray-200">
                        <div class="bg-gray-50 p-4 border-b border-gray-200">
                            <h5 class="text-lg font-bold text-gray-800">üë• ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß (${enrolledStudents.length} ‡∏Ñ‡∏ô)</h5>
                        </div>
                        <div class="p-6">
                            ${enrolledStudents.length > 0 ? `
                                <div class="space-y-3">
                                    ${enrolledStudents.map(student => {
                                        const attendanceCount = currentCourse.attendance.filter(a => a.studentId === student.id).length;
                                        const percentage = Math.round((attendanceCount / 16) * 100);
                                        
                                        return `
                                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                                <div>
                                                    <h6 class="font-bold text-gray-800">${student.id}</h6>
                                                    <p class="text-gray-600">${student.prefix}${student.firstName} ${student.lastName}</p>
                                                    <p class="text-sm text-gray-500">üìß ${student.email} | üì± ${student.phone}</p>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-lg font-bold ${percentage >= 80 ? 'text-green-600' : 'text-red-600'}">${percentage}%</div>
                                                    <p class="text-sm text-gray-600">${attendanceCount}/16 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                                    <button onclick="removeStudentFromCourse('${student.id}')" 
                                                            class="mt-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                                        ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
                                                    </button>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : `
                                <div class="text-center py-8">
                                    <div class="text-6xl mb-4">üë•</div>
                                    <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ</p>
                                    <p class="text-gray-400 text-sm mt-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πÅ‡∏Å‡∏ô QR Code</p>
                                </div>
                            `}
                        </div>
                    </div>

                    ${availableStudents.length > 0 ? `
                        <!-- Available Students -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6">
                            <h5 class="text-lg font-bold text-blue-800 mb-4">üìã ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ</h5>
                            <div class="grid md:grid-cols-2 gap-3 max-h-60 overflow-y-auto">
                                ${availableStudents.map(student => `
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-blue-200">
                                        <div>
                                            <p class="font-medium text-gray-800">${student.id}</p>
                                            <p class="text-sm text-gray-600">${student.prefix}${student.firstName} ${student.lastName}</p>
                                        </div>
                                        <button onclick="addStudentToCourseById('${student.id}')" 
                                                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                            ‡πÄ‡∏û‡∏¥‡πà‡∏°
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function addStudentToCourse() {
            const studentId = document.getElementById('addStudentId').value.trim();
            
            if (!studentId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤');
                return;
            }
            
            if (studentId.length !== 9) {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 9 ‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            const student = users.find(u => u.id === studentId && u.type === 'student');
            
            if (!student) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏£‡∏´‡∏±‡∏™ ' + studentId + ' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }
            
            if (currentCourse.students.includes(studentId)) {
                alert('‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            // Add student to course
            currentCourse.students.push(studentId);
            
            // Add course to student
            if (!student.courses) student.courses = [];
            student.courses.push(currentCourse.id);
            
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${student.prefix}${student.firstName} ${student.lastName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            
            // Clear input and refresh display
            document.getElementById('addStudentId').value = '';
            showStudentManagement();
        }

        function addStudentToCourseById(studentId) {
            const student = users.find(u => u.id === studentId);
            
            // Add student to course
            currentCourse.students.push(studentId);
            
            // Add course to student
            if (!student.courses) student.courses = [];
            student.courses.push(currentCourse.id);
            
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${student.prefix}${student.firstName} ${student.lastName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            showStudentManagement();
        }

        function removeStudentFromCourse(studentId) {
            const student = users.find(u => u.id === studentId);
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${student.prefix}${student.firstName} ${student.lastName} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                // Remove student from course
                currentCourse.students = currentCourse.students.filter(id => id !== studentId);
                
                // Remove course from student
                if (student.courses) {
                    student.courses = student.courses.filter(courseId => courseId !== currentCourse.id);
                }
                
                // Remove attendance records
                currentCourse.attendance = currentCourse.attendance.filter(a => a.studentId !== studentId);
                
                alert('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                showStudentManagement();
            }
        }

        function showGrading() {
            const content = document.getElementById('courseManagementContent');
            content.innerHTML = `
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-6">‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <div class="bg-blue-50 p-6 rounded-lg mb-6">
                        <h5 class="font-bold text-blue-800 mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
                        <div class="flex items-center space-x-4">
                            <label class="text-blue-700">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡∏£‡∏î:</label>
                            <input type="number" id="attendancePercentage" value="10" min="0" max="100" 
                                   class="px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <span class="text-blue-700">%</span>
                            <button onclick="updateAttendanceWeight()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th class="px-4 py-3 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-3 text-center">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th class="px-4 py-3 text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th class="px-4 py-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.filter(u => currentCourse.students.includes(u.id)).map(student => {
                                    const totalClasses = 16;
                                    const attendedClasses = currentCourse.attendance.filter(a => a.studentId === student.id).length;
                                    const percentage = Math.round((attendedClasses / totalClasses) * 100);
                                    const attendanceScore = Math.round((percentage / 100) * 10); // Assume 10% weight
                                    
                                    return `
                                        <tr class="border-b border-gray-200">
                                            <td class="px-4 py-3">${student.id}</td>
                                            <td class="px-4 py-3">${student.prefix}${student.firstName} ${student.lastName}</td>
                                            <td class="px-4 py-3 text-center">${percentage}%</td>
                                            <td class="px-4 py-3 text-center font-bold">${attendanceScore}/10</td>
                                            <td class="px-4 py-3 text-center">
                                                ${percentage >= 80 ? 
                                                    '<span class="text-green-600">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô</span>' : 
                                                    '<span class="text-red-600">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</span>'
                                                }
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function showCreateCourse() {
            document.getElementById('createCourseModal').classList.remove('hidden');
        }

        function hideCreateCourse() {
            document.getElementById('createCourseModal').classList.add('hidden');
            document.getElementById('createCourseForm').reset();
        }

        function updateAttendanceWeight() {
            const percentage = document.getElementById('attendancePercentage').value;
            alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${percentage}% ‡πÅ‡∏•‡πâ‡∏ß`);
        }

        function exportToExcel() {
            alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)');
        }

        function exportToPDF() {
            alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('userInfo').classList.add('hidden');
            showLogin();
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                showLogin();
            }
        }

        // New functions for additional features
        function showQRScanner() {
            document.getElementById('qrScannerModal').classList.remove('hidden');
        }

        function showCourseRegistrationQR(courseId) {
            const course = courses.find(c => c.id === courseId);
            document.getElementById('courseRegistrationQRModal').classList.remove('hidden');
            
            const content = document.getElementById('registrationQRContent');
            content.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-2">${course.code}</h4>
                    <p class="text-gray-600 mb-4">${course.name}</p>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600">üìÖ ${course.day} ${course.time}</p>
                        <p class="text-sm text-gray-600">üè´ ${course.classroom}</p>
                        <p class="text-sm text-gray-600">üìö ${course.credits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</p>
                    </div>
                </div>
                
                <div class="bg-green-50 p-6 rounded-lg mb-6">
                    <div id="registrationQRCode" class="qr-container flex justify-center mb-4"></div>
                    <p class="text-green-600 font-medium mb-2">QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    <p class="text-green-500 text-sm">‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</p>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h5 class="font-bold text-blue-800 mb-2">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h5>
                    <ol class="text-blue-700 text-sm space-y-1 text-left">
                        <li>1. ‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏´‡πá‡∏ô</li>
                        <li>2. ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ TCI Check-in</li>
                        <li>3. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô"</li>
                        <li>4. ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ô‡∏µ‡πâ</li>
                        <li>5. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                    </ol>
                </div>
            `;
            
            generateRegistrationQRCode(course);
        }

        function generateRegistrationQRCode(course) {
            const qrContainer = document.getElementById('registrationQRCode');
            if (!qrContainer) return;
            
            qrContainer.innerHTML = '';
            
            const qrData = `TCI-REGISTER:${course.id}:${course.code}:${course.name}:${course.teacher}`;
            
            QRCode.toCanvas(qrData, { width: 250, height: 250 }, function (error, canvas) {
                if (error) console.error(error);
                qrContainer.appendChild(canvas);
            });
        }

        function closeCourseRegistrationQR() {
            document.getElementById('courseRegistrationQRModal').classList.add('hidden');
        }

        function closeQRScanner() {
            // Stop camera and intervals
            stopQRScanner();
            
            // Reset modal state
            document.getElementById('scanSuccess').classList.add('hidden');
            document.getElementById('scannerInitial').classList.remove('hidden');
            document.getElementById('scannerButtons').classList.remove('hidden');
            
            // Hide modal
            document.getElementById('qrScannerModal').classList.add('hidden');
        }

        let qrStream = null;
        let qrScanInterval = null;

        function startQRScanner() {
            document.getElementById('scannerInitial').classList.add('hidden');
            document.getElementById('cameraView').classList.remove('hidden');
            document.getElementById('scannerButtons').classList.add('hidden');

            // Request camera access
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(stream => {
                qrStream = stream;
                const video = document.getElementById('qrVideo');
                video.srcObject = stream;
                video.play();

                // Start QR code detection simulation
                qrScanInterval = setInterval(() => {
                    // Simulate QR code detection after 3-5 seconds
                    if (Math.random() > 0.7) {
                        detectQRCode();
                    }
                }, 1000);
            })
            .catch(err => {
                console.error('Error accessing camera:', err);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
                stopQRScanner();
            });
        }

        function stopQRScanner() {
            if (qrStream) {
                qrStream.getTracks().forEach(track => track.stop());
                qrStream = null;
            }
            if (qrScanInterval) {
                clearInterval(qrScanInterval);
                qrScanInterval = null;
            }

            document.getElementById('cameraView').classList.add('hidden');
            document.getElementById('scannerInitial').classList.remove('hidden');
            document.getElementById('scannerButtons').classList.remove('hidden');
        }

        function detectQRCode() {
            if (qrScanInterval) {
                clearInterval(qrScanInterval);
                qrScanInterval = null;
            }

            // Stop camera
            if (qrStream) {
                qrStream.getTracks().forEach(track => track.stop());
                qrStream = null;
            }

            // Show success state
            document.getElementById('cameraView').classList.add('hidden');
            document.getElementById('scanSuccess').classList.remove('hidden');

            // Simulate QR code detection - find a course that student is not enrolled in
            const availableCourse = courses.find(c => !c.students.includes(currentUser.id));
            if (availableCourse) {
                document.getElementById('scannedCourseInfo').textContent = 
                    `‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤: ${availableCourse.code} - ${availableCourse.name}`;

                setTimeout(() => {
                    // Add student to course
                    availableCourse.students.push(currentUser.id);
                    
                    // Add course to student
                    if (!currentUser.courses) currentUser.courses = [];
                    currentUser.courses.push(availableCourse.id);
                    
                    // Update localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    alert(`‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ${availableCourse.code} - ${availableCourse.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                    closeQRScanner();
                    loadStudentCourses();
                    loadStudentStats();
                }, 2000);
            } else {
                document.getElementById('scannedCourseInfo').textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ';
                setTimeout(() => {
                    alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                    closeQRScanner();
                }, 2000);
            }
        }

        function simulateQRRegister() {
            startQRScanner();
        }

        function generateSampleQRCode(course) {
            // Create a sample QR code that can be displayed for testing
            const qrData = `TCI-REGISTER:${course.id}:${course.code}:${course.name}`;
            console.log(`Sample QR Code for ${course.code}: ${qrData}`);
            
            // You can display this QR code for testing purposes
            // For now, we'll just log it to console
        }

        function showProfile() {
            document.getElementById('profileModal').classList.remove('hidden');
            showEditProfile();
        }

        function showAllAttendanceHistory() {
            document.getElementById('allAttendanceModal').classList.remove('hidden');
            loadAllAttendanceHistory();
        }

        function closeAllAttendanceHistory() {
            document.getElementById('allAttendanceModal').classList.add('hidden');
        }

        function showDetailedAnalytics() {
            document.getElementById('detailedAnalyticsModal').classList.remove('hidden');
            loadDetailedAnalytics();
        }

        function closeDetailedAnalytics() {
            document.getElementById('detailedAnalyticsModal').classList.add('hidden');
        }

        function closeProfile() {
            document.getElementById('profileModal').classList.add('hidden');
        }

        function showEditProfile() {
            const content = document.getElementById('profileContent');
            content.innerHTML = `
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h4>
                    <form id="editProfileForm" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                                <input type="text" value="${currentUser.id}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="editPrefix" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                    <option value="‡∏ô‡∏≤‡∏¢" ${currentUser.prefix === '‡∏ô‡∏≤‡∏¢' ? 'selected' : ''}>‡∏ô‡∏≤‡∏¢</option>
                                    <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß" ${currentUser.prefix === '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß' ? 'selected' : ''}>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                    <option value="‡∏ô‡∏≤‡∏á" ${currentUser.prefix === '‡∏ô‡∏≤‡∏á' ? 'selected' : ''}>‡∏ô‡∏≤‡∏á</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="editFirstName" value="${currentUser.firstName}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="editLastName" value="${currentUser.lastName}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                            <input type="text" value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="tel" id="editPhone" value="${currentUser.phone}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                                <input type="email" id="editEmail" value="${currentUser.email}" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            </div>
                        </div>

                        <button type="submit" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                        </button>
                    </form>
                </div>
            `;

            document.getElementById('editProfileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Update user data
                currentUser.prefix = document.getElementById('editPrefix').value;
                currentUser.firstName = document.getElementById('editFirstName').value;
                currentUser.lastName = document.getElementById('editLastName').value;
                currentUser.phone = document.getElementById('editPhone').value;
                currentUser.email = document.getElementById('editEmail').value;
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                }
                
                // Update localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update display
                document.getElementById('userName').textContent = `${currentUser.prefix}${currentUser.firstName} ${currentUser.lastName}`;
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            });
        }

        function loadAllAttendanceHistory() {
            const content = document.getElementById('allAttendanceContent');
            const studentCourses = courses.filter(course => course.students.includes(currentUser.id));
            
            content.innerHTML = `
                <div class="mb-8">
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600">${studentCourses.length}</div>
                            <p class="text-blue-800 text-sm">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600">
                                ${studentCourses.reduce((total, course) => total + course.attendance.filter(a => a.studentId === currentUser.id).length, 0)}
                            </div>
                            <p class="text-green-800 text-sm">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-600">
                                ${Math.round(studentCourses.reduce((total, course) => {
                                    const attended = course.attendance.filter(a => a.studentId === currentUser.id).length;
                                    return total + (attended / 16) * 100;
                                }, 0) / studentCourses.length) || 0}%
                            </div>
                            <p class="text-yellow-800 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-red-600">
                                ${studentCourses.filter(course => {
                                    const percentage = Math.round((course.attendance.filter(a => a.studentId === currentUser.id).length / 16) * 100);
                                    return percentage < 80;
                                }).length}
                            </div>
                            <p class="text-red-800 text-sm">‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    ${studentCourses.map(course => {
                        const attendanceRecords = course.attendance.filter(a => a.studentId === currentUser.id);
                        const percentage = Math.round((attendanceRecords.length / 16) * 100);
                        return `
                            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                                <div class="bg-gray-50 p-6 border-b border-gray-200">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h5 class="text-xl font-bold text-gray-800">${course.code} - ${course.name}</h5>
                                            <p class="text-gray-600 mt-1">üìÖ ${course.day} ${course.time} | üè´ ${course.classroom}</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold ${percentage >= 80 ? 'text-green-600' : 'text-red-600'}">${percentage}%</div>
                                            <p class="text-sm text-gray-600">${attendanceRecords.length}/16 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-6">
                                    ${attendanceRecords.length > 0 ? `
                                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            ${attendanceRecords.map((record, index) => `
                                                <div class="bg-green-50 p-3 rounded-lg">
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm font-medium text-green-800">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${index + 1}</span>
                                                        <span class="text-green-600">‚úÖ</span>
                                                    </div>
                                                    <p class="text-xs text-green-600 mt-1">${new Date(record.timestamp).toLocaleDateString('th-TH')}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : `
                                        <div class="text-center py-8">
                                            <div class="text-4xl mb-2">üìö</div>
                                            <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ</p>
                                        </div>
                                    `}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function loadDetailedAnalytics() {
            const content = document.getElementById('detailedAnalyticsContent');
            const studentCourses = courses.filter(course => course.students.includes(currentUser.id));
            
            // Calculate analytics data
            const totalAttendance = studentCourses.reduce((total, course) => total + course.attendance.filter(a => a.studentId === currentUser.id).length, 0);
            const averagePercentage = Math.round(studentCourses.reduce((total, course) => {
                const attended = course.attendance.filter(a => a.studentId === currentUser.id).length;
                return total + (attended / 16) * 100;
            }, 0) / studentCourses.length) || 0;
            const riskyCourses = studentCourses.filter(course => {
                const percentage = Math.round((course.attendance.filter(a => a.studentId === currentUser.id).length / 16) * 100);
                return percentage < 80;
            });
            
            content.innerHTML = `
                <div class="space-y-8">
                    <!-- Overview Cards -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-600 text-sm font-medium">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                    <p class="text-3xl font-bold text-blue-800">${studentCourses.length}</p>
                                </div>
                                <div class="text-blue-500 text-3xl">üìö</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-600 text-sm font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°</p>
                                    <p class="text-3xl font-bold text-green-800">${totalAttendance}</p>
                                </div>
                                <div class="text-green-500 text-3xl">‚úÖ</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-600 text-sm font-medium">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                                    <p class="text-3xl font-bold text-yellow-800">${averagePercentage}%</p>
                                </div>
                                <div class="text-yellow-500 text-3xl">üìä</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-600 text-sm font-medium">‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</p>
                                    <p class="text-3xl font-bold text-red-800">${riskyCourses.length}</p>
                                </div>
                                <div class="text-red-500 text-3xl">‚ö†Ô∏è</div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Analysis -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <h5 class="text-xl font-bold text-gray-800 mb-6">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
                        <div class="space-y-6">
                            ${studentCourses.map(course => {
                                const attendanceCount = course.attendance.filter(a => a.studentId === currentUser.id).length;
                                const percentage = Math.round((attendanceCount / 16) * 100);
                                const status = percentage >= 80 ? '‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢' : percentage >= 60 ? '‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á' : '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢';
                                const statusColor = percentage >= 80 ? 'green' : percentage >= 60 ? 'yellow' : 'red';
                                
                                return `
                                    <div class="border border-gray-200 rounded-lg p-6">
                                        <div class="flex justify-between items-start mb-4">
                                            <div>
                                                <h6 class="text-lg font-bold text-gray-800">${course.code} - ${course.name}</h6>
                                                <p class="text-gray-600 text-sm">${course.credits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï | ${course.day} ${course.time}</p>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-2xl font-bold text-${statusColor}-600">${percentage}%</div>
                                                <span class="px-3 py-1 rounded-full text-xs font-medium bg-${statusColor}-100 text-${statusColor}-600">
                                                    ${status}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                                <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                                                <span>${attendanceCount}/16 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                            </div>
                                            <div class="bg-gray-200 rounded-full h-3">
                                                <div class="h-3 rounded-full bg-${statusColor}-500 transition-all duration-500" 
                                                     style="width: ${percentage}%"></div>
                                            </div>
                                        </div>

                                        <div class="grid md:grid-cols-3 gap-4 text-sm">
                                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                                <p class="text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                                                <p class="font-bold text-green-600">${attendanceCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                                <p class="text-gray-600">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                                                <p class="font-bold text-red-600">${16 - attendanceCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                                <p class="text-gray-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                                                <p class="font-bold text-blue-600">${Math.max(0, Math.ceil(16 * 0.8) - attendanceCount)} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                            </div>
                                        </div>

                                        ${percentage < 80 ? `
                                            <div class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                                <p class="text-red-800 text-sm font-medium">‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</p>
                                                <p class="text-red-700 text-sm mt-1">
                                                    ${percentage < 60 ? 
                                                        '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå 80%' : 
                                                        `‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${Math.ceil(16 * 0.8) - attendanceCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠`
                                                    }
                                                </p>
                                            </div>
                                        ` : `
                                            <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                                                <p class="text-green-800 text-sm font-medium">‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</p>
                                                <p class="text-green-700 text-sm mt-1">‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≤‡∏î‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ${attendanceCount - Math.ceil(16 * 0.8)} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                            </div>
                                        `}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    ${riskyCourses.length > 0 ? `
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                            <h5 class="text-xl font-bold text-red-800 mb-4">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á</h5>
                            <div class="space-y-3">
                                ${riskyCourses.map(course => {
                                    const attendanceCount = course.attendance.filter(a => a.studentId === currentUser.id).length;
                                    const percentage = Math.round((attendanceCount / 16) * 100);
                                    const needed = Math.ceil(16 * 0.8) - attendanceCount;
                                    
                                    return `
                                        <div class="bg-white p-4 rounded-lg border border-red-200">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <h6 class="font-bold text-red-800">${course.code} - ${course.name}</h6>
                                                    <p class="text-red-600 text-sm">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${percentage}% (${attendanceCount}/16 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-red-800 font-bold">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏µ‡∏Å</p>
                                                    <p class="text-2xl font-bold text-red-600">${Math.max(0, needed)} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : `
                        <div class="bg-green-50 border border-green-200 rounded-xl p-6 text-center">
                            <div class="text-6xl mb-4">üéâ</div>
                            <h5 class="text-xl font-bold text-green-800 mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h5>
                            <p class="text-green-700">‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß</p>
                        </div>
                    `}
                </div>
            `;
        }

        function showCourseHistory(courseId) {
            const course = courses.find(c => c.id === courseId);
            const attendanceRecords = course.attendance.filter(a => a.studentId === currentUser.id);
            
            document.getElementById('courseHistoryModal').classList.remove('hidden');
            document.getElementById('courseHistoryTitle').textContent = `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ${course.code}`;
            
            const content = document.getElementById('courseHistoryContent');
            content.innerHTML = `
                <div class="mb-6">
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">${course.name}</h4>
                        <div class="grid md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">${course.credits}</div>
                                <p class="text-blue-800 text-sm">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</p>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">${attendanceRecords.length}</div>
                                <p class="text-green-800 text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-yellow-600">${16 - attendanceRecords.length}</div>
                                <p class="text-yellow-800 text-sm">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold ${Math.round((attendanceRecords.length / 16) * 100) >= 80 ? 'text-green-600' : 'text-red-600'}">
                                    ${Math.round((attendanceRecords.length / 16) * 100)}%
                                </div>
                                <p class="text-gray-800 text-sm">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg">
                    <div class="p-6 border-b border-gray-200">
                        <h5 class="text-lg font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
                    </div>
                    <div class="p-6">
                        ${attendanceRecords.length > 0 ? `
                            <div class="space-y-3">
                                ${attendanceRecords.map((record, index) => `
                                    <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-green-800">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${index + 1}</p>
                                            <p class="text-green-600 text-sm">${new Date(record.timestamp).toLocaleString('th-TH')}</p>
                                        </div>
                                        <div class="text-green-600">
                                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8">
                                <div class="text-6xl mb-4">üìö</div>
                                <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ</p>
                                <p class="text-gray-400 text-sm mt-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function closeCourseHistory() {
            document.getElementById('courseHistoryModal').classList.add('hidden');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98e4073766338954',t:'MTc2MDQxMjk0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
